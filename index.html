<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Item Shop Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ffffff;
            --background-start: #3a0ca3;
            --background-end: #0096c7;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.15);
            --button-bg: rgba(255, 255, 255, 0.2);
            --button-hover-bg: rgba(255, 255, 255, 0.3);
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --info-color: #2196F3;
            --progress-bar-bg: rgba(255, 255, 255, 0.2);
            --progress-bar-fill: #ffffff;

            /* Fortnite Rarity Colors */
            --rarity-legendary: #ffc83d;
            --rarity-epic: #b250e2;
            --rarity-rare: #3cabf5;
            --rarity-uncommon: #5dc333;
            --rarity-common: #c4c4c4;
            /* Added new rarities from fortniteapi.io */
            --rarity-mythic: #d4af37;
            --rarity-icon: #17e7e7;
            --rarity-dark: #ff3e3e;

        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--background-start), var(--background-end));
            color: var(--primary-color);
            overflow: hidden;
            position: relative;
        }

        body::before, body::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(90px);
            opacity: 0.5;
        }

        body::before {
            width: 350px;
            height: 350px;
            background: #f72585;
            top: 5%;
            left: 10%;
            animation: move-blob 15s infinite alternate;
        }

        body::after {
            width: 400px;
            height: 400px;
            background: #4cc9f0;
            bottom: 5%;
            right: 10%;
            animation: move-blob 20s infinite alternate-reverse;
        }

        @keyframes move-blob {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(80px, -40px) scale(1.2); }
        }

        .container {
            position: relative;
            z-index: 2;
            width: 95%;
            max-width: 900px; /* Breiter für Shop-Ansicht */
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }
        
        .main-card {
             display: flex;
             flex-direction: column;
             gap: 1rem;
             max-height: 90vh;
        }
        
        h1 {
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        p {
            font-weight: 300;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .status-display {
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 400;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .status-default { background: rgba(0,0,0,0.1); }
        .status-info { background: rgba(33, 150, 243, 0.3); }
        .status-warning { background: rgba(255, 152, 0, 0.3); }
        .status-success { background: rgba(76, 175, 80, 0.3); }
        
        /* Item Shop Container */
        .item-shop-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            overflow-y: auto;
            padding: 1rem;
            margin: -1rem;
            max-height: 55vh;
        }
        .item-shop-container::-webkit-scrollbar { width: 8px; }
        .item-shop-container::-webkit-scrollbar-track { background: transparent; }
        .item-shop-container::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 4px; }

        .item-card {
            background: rgba(0,0,0,0.25);
            border-radius: 15px;
            overflow: hidden;
            text-align: left;
            border-top: 4px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .item-card img.item-image {
            width: 100%;
            height: auto;
            display: block;
            background-color: #2a2a2a;
        }
        .item-info {
            padding: 1rem;
        }
        .item-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .item-price {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            opacity: 0.9;
        }
        .item-price img.vbucks-icon {
            width: 24px;
            height: 24px;
        }

        /* Rarity Border Colors */
        .rarity-legendary { border-color: var(--rarity-legendary); }
        .rarity-epic { border-color: var(--rarity-epic); }
        .rarity-rare { border-color: var(--rarity-rare); }
        .rarity-uncommon { border-color: var(--rarity-uncommon); }
        .rarity-common { border-color: var(--rarity-common); }
        .rarity-mythic { border-color: var(--rarity-mythic); }
        .rarity-icon { border-color: var(--rarity-icon); }
        .rarity-dark { border-color: var(--rarity-dark); }

        .btn {
            background: var(--button-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--primary-color);
            padding: 0.8rem 1.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 400;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease;
            width: 100%;
        }

        .btn:hover:not(:disabled) {
            background: var(--button-hover-bg);
            transform: scale(1.02);
        }
        
        .modal {
            position: fixed;
            z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none; justify-content: center; align-items: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-content { width: 90%; max-width: 400px; }
        .modal-content h2 { margin-bottom: 1rem; }
        .modal-content p { margin-bottom: 1.5rem; }
        .modal-buttons { display: flex; gap: 1rem; justify-content: center; }
        .btn-confirm { background: rgba(76, 175, 80, 0.4); }
        .btn-confirm:hover { background: rgba(76, 175, 80, 0.6); }
        .btn-cancel { background: rgba(244, 67, 54, 0.4); }
        .btn-cancel:hover { background: rgba(244, 67, 54, 0.6); }
        
        .progress-overlay {
            position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            display: none; flex-direction: column; justify-content: center; align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .progress-bar-container { width: 80%; max-width: 400px; background-color: var(--progress-bar-bg); border-radius: 10px; overflow: hidden; border: 1px solid var(--glass-border); }
        .progress-bar { width: 0%; height: 20px; background-color: var(--progress-bar-fill); border-radius: 10px; transition: width 0.2s ease-out; }
        .progress-text { margin-top: 1rem; font-size: 1.1rem; }
        
        .footer-info {
            display: flex; justify-content: flex-end; align-items: center;
            gap: 0.5rem; margin-top: 1rem; position: relative;
        }
        .version-display { font-size: 0.8rem; color: var(--primary-color); opacity: 0.6; }
        #updateLaterButton {
            background: none; border: none; color: var(--primary-color);
            cursor: pointer; opacity: 0.7; transition: opacity 0.3s ease, transform 0.3s ease;
            padding: 0.2rem; display: flex; align-items: center;
        }
        #updateLaterButton:hover { opacity: 1; transform: scale(1.1); }
        #updateLaterButton svg { width: 20px; height: 20px; }

    </style>
</head>
<body>

    <div class="container">
        <div class="glass-card main-card">
            <h1>Fortnite Item-Shop</h1>
            <div id="statusDisplay" class="status-display status-default">Initialisiere...</div>
            <div id="itemShopContainer" class="item-shop-container">
                <!-- Shop-Items werden hier dynamisch eingefügt -->
            </div>
            <div class="footer-info">
                 <div class="update-later-container" id="updateLaterContainer" style="display: none;">
                    <button id="updateLaterButton" title="Update verfügbar">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                    </button>
                </div>
                <div id="versionDisplay" class="version-display"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="updateModal" class="modal">
        <div class="glass-card modal-content">
            <h2>Update verfügbar!</h2>
            <p>Eine neue Version der Anwendung ist verfügbar. Möchtest du sie jetzt installieren und die Seite neu starten?</p>
            <div class="modal-buttons">
                <button id="confirmUpdateButton" class="btn btn-confirm">Ja, installieren</button>
                <button id="cancelUpdateButton" class="btn btn-cancel">Nicht jetzt</button>
            </div>
        </div>
    </div>

    <div id="progressOverlay" class="progress-overlay">
        <p class="progress-text">Update wird aktiviert...</p>
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
    </div>

    <!-- App Source -->
    <script type="application/json" id="main-script-source">
        {
            "version": "1.2",
            "code": "(() => { const APP_VERSION = '1.2'; document.getElementById('versionDisplay').textContent = 'Version ' + APP_VERSION; const statusDisplay = document.getElementById('statusDisplay'); const itemShopContainer = document.getElementById('itemShopContainer'); const API_KEY = '69eac605-420ddfb7-ad6d74d2-7244a7cb'; const VBUCKS_ICON_URL = 'https://media.fortniteapi.io/images/652b99217354a2472f174b33/transparent.png'; function updateStatus(message, type = 'default') { statusDisplay.textContent = message; statusDisplay.className = 'status-display'; statusDisplay.classList.add(`status-${type}`); } function renderShop(shopItems) { itemShopContainer.innerHTML = ''; if (!shopItems || shopItems.length === 0) { updateStatus('Shop ist derzeit leer oder konnte nicht geladen werden.', 'info'); return; } shopItems.forEach(entry => { const card = document.createElement('div'); card.className = 'item-card'; const rarity = entry.rarity?.id.toLowerCase() || 'common'; card.classList.add(`rarity-${rarity}`); const imageSrc = entry.displayAssets[0]?.url; if (!imageSrc) return; card.innerHTML = ` <img src='${imageSrc}' alt='${entry.displayName}' loading='lazy' class='item-image'> <div class='item-info'> <h3>${entry.displayName}</h3> <div class='item-price'> <img src='${VBUCKS_ICON_URL}' alt='V-Bucks' class='vbucks-icon'> <span>${entry.price.finalPrice}</span> </div> </div> `; itemShopContainer.appendChild(card); }); } async function fetchShopData() { updateStatus('Lade Item-Shop...', 'info'); try { const response = await fetch('https://fortniteapi.io/v2/shop?lang=de', { headers: { 'Authorization': API_KEY } }); if (!response.ok) { throw new Error(`HTTP-Fehler! Status: ${response.status}`); } const data = await response.json(); if (data.result) { renderShop(data.shop); updateStatus('Item-Shop erfolgreich geladen.', 'success'); } else { throw new Error('API-Anfrage fehlgeschlagen.'); } } catch (error) { console.error('Fehler beim Abrufen der Shop-Daten:', error); updateStatus('Fehler beim Laden des Shops.', 'warning'); } } fetchShopData(); })()"
        }
    </script>
    
    <!-- Loader Script -->
    <script id="loader-script">
        document.addEventListener('DOMContentLoaded', () => {
            const SCRIPT_STORAGE_KEY = 'app_script_content_fortnite';
            const mainScriptSourceEl = document.getElementById('main-script-source');
            const updateModal = document.getElementById('updateModal');
            const confirmUpdateButton = document.getElementById('confirmUpdateButton');
            const cancelUpdateButton = document.getElementById('cancelUpdateButton');
            const progressOverlay = document.getElementById('progressOverlay');
            const progressBar = document.getElementById('progressBar');
            const statusDisplay = document.getElementById('statusDisplay');
            const updateLaterContainer = document.getElementById('updateLaterContainer');
            const updateLaterButton = document.getElementById('updateLaterButton');

            if (!mainScriptSourceEl || !mainScriptSourceEl.textContent) {
                statusDisplay.textContent = "Fataler Fehler: App-Quelle nicht gefunden.";
                statusDisplay.className = 'status-display status-warning';
                return;
            }
            const newScriptPayload = mainScriptSourceEl.textContent;
            function executeScript(scriptContent) {
                try {
                    const scriptData = JSON.parse(scriptContent);
                    const script = document.createElement('script');
                    script.textContent = scriptData.code;
                    document.body.appendChild(script);
                } catch(e) { console.error("Fehler beim Ausführen des Skripts:", e); statusDisplay.textContent = "Fehler beim Laden der App."; statusDisplay.className = 'status-display status-warning'; localStorage.removeItem(SCRIPT_STORAGE_KEY); }
            }
            function isLocalStorageAvailable() {
                try { const testKey = '__test__'; localStorage.setItem(testKey, testKey); localStorage.removeItem(testKey); return true; } catch (e) { return false; }
            }
            function triggerUpdate() {
                progressOverlay.style.display = 'flex'; let progress = 0;
                const interval = setInterval(() => { progress += 5; progressBar.style.width = progress + '%'; if (progress >= 100) { clearInterval(interval); localStorage.setItem(SCRIPT_STORAGE_KEY, newScriptPayload); setTimeout(() => location.reload(true), 300); } }, 50);
            }
            if (!isLocalStorageAvailable()) { statusDisplay.textContent = "Speicher blockiert. App kann nicht gestartet werden."; statusDisplay.className = 'status-display status-warning'; return; }
            const storedScriptContent = localStorage.getItem(SCRIPT_STORAGE_KEY);
            if (!storedScriptContent) { localStorage.setItem(SCRIPT_STORAGE_KEY, newScriptPayload); executeScript(newScriptPayload); }
            else {
                const storedVersion = JSON.parse(storedScriptContent).version;
                const newVersion = JSON.parse(newScriptPayload).version;
                if (storedVersion !== newVersion) {
                    updateModal.style.display = 'flex';
                    confirmUpdateButton.onclick = triggerUpdate;
                    cancelUpdateButton.onclick = () => { updateModal.style.display = 'none'; updateLaterContainer.style.display = 'flex'; executeScript(storedScriptContent); };
                    updateLaterButton.onclick = () => { updateModal.style.display = 'flex'; };
                } else {
                    executeScript(storedScriptContent);
                    setTimeout(() => { if (statusDisplay.textContent === 'Initialisiere...') { statusDisplay.textContent = 'Software ist auf dem neuesten Stand.'; statusDisplay.className = 'status-display status-success'; } }, 2000);
                }
            }
        });
    </script>
</body>
</html>

