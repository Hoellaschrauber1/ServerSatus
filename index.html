<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Asset Explorer</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font 'Inter' for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply the Inter font to the entire body */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom scrollbar for better aesthetics, mimicking the original design */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Simple pulse animation for loading skeletons */
        @keyframes pulse {
            50% {
                opacity: .5;
            }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-4 md:p-8 min-h-screen">
    <!-- Main container for the entire application, centered on the page -->
    <div class="max-w-7xl mx-auto">
        <!-- Header with title and navigation -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 md:mb-8 space-y-4 md:space-y-0">
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-red-500">
                Fortnite Asset Explorer
            </h1>
            <!-- Language and Version display in the header -->
            <div class="flex items-center space-x-4">
                <span id="app-version-display" class="text-xs text-gray-400"></span>
                <select id="language-select" class="bg-gray-800 text-gray-100 rounded-lg p-2 text-sm focus:ring-2 focus:ring-purple-500 transition-colors">
                    <option value="de">Deutsch</option>
                    <option value="en">English</option>
                </select>
            </div>
        </header>

        <!-- Navigation Buttons -->
        <nav class="flex flex-wrap justify-center sm:justify-start gap-3 mb-6">
            <button id="show-outfits-btn" data-category="outfit" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Outfits</button>
            <button id="show-backpacks-btn" data-category="backpack" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Rucksäcke</button>
            <button id="show-pickaxes-btn" data-category="pickaxe" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Spitzhacken</button>
            <button id="show-gliders-btn" data-category="glider" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Hängegleiter</button>
            <button id="show-emotes-btn" data-category="emote" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Emotes</button>
            <button id="show-wraps-btn" data-category="wrap" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Lackierungen</button>
            <button id="show-music-btn" data-category="music" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Musik</button>
            <button id="show-lobby-backgrounds-btn" data-category="loading_screen" class="nav-btn bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">Lobby-Hintergründe</button>
        </nav>

        <!-- Filter and Sort Controls -->
        <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
            <!-- Sort dropdown -->
            <div class="flex items-center space-x-2">
                <label for="sort-select" class="text-gray-400">Sortieren:</label>
                <select id="sort-select" class="bg-gray-800 text-gray-100 rounded-lg p-2 text-sm focus:ring-2 focus:ring-purple-500 transition-colors">
                    <option value="name">Name (A-Z)</option>
                    <option value="rarity">Seltenheit</option>
                </select>
            </div>
            <!-- Rarity filter dropdown -->
            <div class="flex items-center space-x-2">
                <label for="rarity-filter-select" class="text-gray-400">Seltenheit:</label>
                <select id="rarity-filter-select" class="bg-gray-800 text-gray-100 rounded-lg p-2 text-sm focus:ring-2 focus:ring-purple-500 transition-colors">
                    <option value="all">Alle</option>
                    <option value="legendary">Legendär</option>
                    <option value="epic">Episch</option>
                    <option value="rare">Selten</option>
                    <option value="uncommon">Ungewöhnlich</option>
                    <option value="common">Gewöhnlich</option>
                </select>
            </div>
            <!-- New items filter button -->
            <button id="filter-new-btn" class="bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">
                Neue Artikel filtern
            </button>
            <!-- Show/hide loading screen button -->
            <button id="toggle-loading-screen-btn" class="bg-gray-800 hover:bg-gray-700 text-gray-100 px-4 py-2 rounded-lg font-medium transition-colors">
                Ladebildschirm
            </button>
        </div>

        <!-- Main content area where items are displayed -->
        <div id="item-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
            <!-- Items will be dynamically inserted here -->
        </div>
    </div>

    <!-- JavaScript for all application logic -->
    <script>
        // --- Configuration & State ---
        // A simple object to store translated UI strings
        const translations = {
            'de': {
                outfits: 'Outfits',
                backpacks: 'Rucksäcke',
                pickaxes: 'Spitzhacken',
                gliders: 'Hängegleiter',
                emotes: 'Emotes',
                wraps: 'Lackierungen',
                music: 'Musik',
                lobbyBackgrounds: 'Lobby-Hintergründe',
                filterNewBtn: 'Neue Artikel filtern',
                toggleLobbyBtn: 'Lobby-Hintergründe',
                filterNewBtnActive: 'Alle Artikel anzeigen',
                toggleLobbyBtnActive: 'Zurück zur Kategorie',
                sortLabel: 'Sortieren:',
                rarityLabel: 'Seltenheit:',
                sortName: 'Name (A-Z)',
                sortRarity: 'Seltenheit',
                rarityAll: 'Alle',
                rarityLegendary: 'Legendär',
                rarityEpic: 'Episch',
                rarityRare: 'Selten',
                rarityUncommon: 'Ungewöhnlich',
                rarityCommon: 'Gewöhnlich',
                appTitle: 'Fortnite Asset Explorer',
                noItemsFound: 'Keine Artikel gefunden.',
            },
            'en': {
                outfits: 'Outfits',
                backpacks: 'Backpacks',
                pickaxes: 'Pickaxes',
                gliders: 'Gliders',
                emotes: 'Emotes',
                wraps: 'Wraps',
                music: 'Music',
                lobbyBackgrounds: 'Lobby Backgrounds',
                filterNewBtn: 'Filter New Items',
                toggleLobbyBtn: 'Show Lobby Backgrounds',
                filterNewBtnActive: 'Show All Items',
                toggleLobbyBtnActive: 'Back to Categories',
                sortLabel: 'Sort:',
                rarityLabel: 'Rarity:',
                sortName: 'Name (A-Z)',
                sortRarity: 'Rarity',
                rarityAll: 'All',
                rarityLegendary: 'Legendary',
                rarityEpic: 'Epic',
                rarityRare: 'Rare',
                rarityUncommon: 'Uncommon',
                rarityCommon: 'Common',
                appTitle: 'Fortnite Asset Explorer',
                noItemsFound: 'No items found.',
            }
        };

        // Current application state
        let currentLanguage = 'de';
        let currentView = 'outfit';
        let currentSortOrder = 'name';
        let currentFilterRarity = 'all';
        let isFilteringNew = false;
        let cosmeticData = {}; // Cache for fetched data
        const appVersion = 'V2.38';

        // --- DOM Elements ---
        const navButtons = document.querySelectorAll('.nav-btn');
        const itemGrid = document.getElementById('item-grid');
        const languageSelect = document.getElementById('language-select');
        const sortSelect = document.getElementById('sort-select');
        const rarityFilterSelect = document.getElementById('rarity-filter-select');
        const filterNewBtn = document.getElementById('filter-new-btn');
        const toggleLobbyBtn = document.getElementById('toggle-loading-screen-btn');
        const appVersionDisplay = document.getElementById('app-version-display');

        // --- Core Functions ---
        
        /**
         * Fetches real cosmetic data from the Fortnite-API.com.
         * @param {string} category The category to fetch data for.
         * @returns {Promise<Object[]>} A promise that resolves with the data.
         */
        async function fetchRealCosmeticData(category) {
            try {
                // Construct the API URL with the correct language and category
                const apiUrl = `https://fortnite-api.com/v2/cosmetics/br/search/all?type=${category}&language=${currentLanguage}`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`API-Fehler: ${response.statusText}`);
                }
                const data = await response.json();
                
                // The API response has a "data" property containing the array of cosmetics
                return data.data || [];
            } catch (error) {
                console.error("Fehler beim Abrufen der Daten von der API:", error);
                itemGrid.innerHTML = `<p class="col-span-full text-center text-red-400 text-lg py-12">Es gab ein Problem beim Laden der Daten. Bitte versuchen Sie es später erneut.</p>`;
                return [];
            }
        }

        /**
         * Generates the HTML for a single cosmetic item card.
         * @param {Object} item The cosmetic item data from the API.
         * @returns {string} The HTML string for the item card.
         */
        function createItemCard(item) {
            const isNew = item.introduction && item.introduction.text.toLowerCase().includes('new');
            const isNewBadge = isNew ? `<span class="absolute top-2 right-2 bg-purple-500 text-xs font-bold px-2 py-1 rounded-full text-white">Neu</span>` : '';
            const rarity = item.rarity ? item.rarity.value : 'common';
            const rarityClass = getRarityColor(rarity);
            const imageUrl = item.images.icon;
            
            return `
                <div class="bg-gray-800 rounded-xl p-4 shadow-lg transform transition-transform duration-200 hover:scale-105 relative border-2 ${rarityClass}">
                    <!-- The loading="lazy" attribute tells the browser to only load the image when it is near the viewport -->
                    <img src="${imageUrl}" loading="lazy" alt="${item.name}" class="rounded-lg w-full mb-3" onerror="this.onerror=null; this.src='https://placehold.co/200x200/374151/D1D5DB?text=Image+Not+Found';">
                    <h3 class="text-sm font-semibold truncate">${item.name}</h3>
                    <p class="text-xs text-gray-400 capitalize">${rarity}</p>
                    ${isNewBadge}
                </div>
            `;
        }

        /**
         * Gets the Tailwind color class for a given rarity.
         * @param {string} rarity The rarity of the item.
         * @returns {string} The Tailwind class for the border color.
         */
        function getRarityColor(rarity) {
            switch (rarity) {
                case 'legendary': return 'border-orange-500';
                case 'epic': return 'border-purple-500';
                case 'rare': return 'border-blue-500';
                case 'uncommon': return 'border-green-500';
                case 'common': return 'border-gray-500';
                default: return 'border-gray-500';
            }
        }
        
        /**
         * Displays a loading skeleton in the grid.
         */
        function showLoadingState() {
            itemGrid.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                itemGrid.innerHTML += `
                    <div class="bg-gray-800 rounded-xl p-4 shadow-lg animate-pulse h-48 flex flex-col justify-end">
                        <div class="bg-gray-700 h-4 w-3/4 rounded-lg mb-2"></div>
                        <div class="bg-gray-700 h-3 w-1/2 rounded-lg"></div>
                    </div>
                `;
            }
        }

        /**
         * Updates the UI to show the list of items based on current filters and sorting.
         */
        function updateGrid() {
            const data = cosmeticData[currentView] || [];
            
            // Filter data based on selected rarity and "new" status
            const filteredData = data.filter(item => {
                const rarityMatch = currentFilterRarity === 'all' || (item.rarity && item.rarity.value === currentFilterRarity);
                const isNew = item.introduction && item.introduction.text.toLowerCase().includes('new');
                const newMatch = !isFilteringNew || isNew;
                return rarityMatch && newMatch;
            });

            // Sort data based on selected sort order
            filteredData.sort((a, b) => {
                if (currentSortOrder === 'name') {
                    return a.name.localeCompare(b.name, currentLanguage);
                }
                // Sort by rarity (this is a simplified rarity order)
                const rarityOrder = ['legendary', 'epic', 'rare', 'uncommon', 'common'];
                const rarityA = a.rarity ? a.rarity.value : 'common';
                const rarityB = b.rarity ? b.rarity.value : 'common';
                return rarityOrder.indexOf(rarityA) - rarityOrder.indexOf(rarityB);
            });

            // Generate HTML for each item and insert into the grid
            if (filteredData.length > 0) {
                itemGrid.innerHTML = filteredData.map(createItemCard).join('');
            } else {
                itemGrid.innerHTML = `<p class="col-span-full text-center text-gray-400 text-lg py-12">${translations[currentLanguage].noItemsFound}</p>`;
            }
        }

        /**
         * Loads cosmetic data for a given category and updates the UI.
         * @param {string} category The category to load.
         */
        async function loadCosmeticsCategory(category) {
            currentView = category;
            updateNavButtons(category);
            showLoadingState();

            if (!cosmeticData[category]) {
                const data = await fetchRealCosmeticData(category);
                cosmeticData[category] = data;
            }

            updateGrid();
        }

        /**
         * Updates the active state of the navigation buttons.
         * @param {string} activeCategory The category to mark as active.
         */
        function updateNavButtons(activeCategory) {
            navButtons.forEach(btn => {
                const category = btn.getAttribute('data-category');
                if (category === activeCategory) {
                    btn.classList.add('bg-purple-600', 'text-white');
                    btn.classList.remove('bg-gray-800');
                } else {
                    btn.classList.remove('bg-purple-600', 'text-white');
                    btn.classList.add('bg-gray-800');
                }
            });
        }

        /**
         * Updates all UI text elements based on the current language.
         */
        function updateUIForLanguage() {
            const lang = translations[currentLanguage];
            document.title = lang.appTitle;

            document.getElementById('show-outfits-btn').textContent = lang.outfits;
            document.getElementById('show-backpacks-btn').textContent = lang.backpacks;
            document.getElementById('show-pickaxes-btn').textContent = lang.pickaxes;
            document.getElementById('show-gliders-btn').textContent = lang.gliders;
            document.getElementById('show-emotes-btn').textContent = lang.emotes;
            document.getElementById('show-wraps-btn').textContent = lang.wraps;
            document.getElementById('show-music-btn').textContent = lang.music;
            document.getElementById('show-lobby-backgrounds-btn').textContent = lang.lobbyBackgrounds;

            document.querySelector('label[for="sort-select"]').textContent = lang.sortLabel;
            document.getElementById('sort-select').options[0].textContent = lang.sortName;
            document.getElementById('sort-select').options[1].textContent = lang.sortRarity;

            document.querySelector('label[for="rarity-filter-select"]').textContent = lang.rarityLabel;
            document.getElementById('rarity-filter-select').options[0].textContent = lang.rarityAll;
            document.getElementById('rarity-filter-select').options[1].textContent = lang.rarityLegendary;
            document.getElementById('rarity-filter-select').options[2].textContent = lang.rarityEpic;
            document.getElementById('rarity-filter-select').options[3].textContent = lang.rarityRare;
            document.getElementById('rarity-filter-select').options[4].textContent = lang.rarityUncommon;
            document.getElementById('rarity-filter-select').options[5].textContent = lang.rarityCommon;
            
            filterNewBtn.textContent = isFilteringNew ? lang.filterNewBtnActive : lang.filterNewBtn;
            toggleLobbyBtn.textContent = (currentView === 'loading_screen') ? lang.toggleLobbyBtnActive : lang.toggleLobbyBtn;
        }

        // --- Event Listeners ---
        
        // Listen for clicks on navigation buttons
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Ensure the 'lobby screen' button does not toggle its view when already active
                if (button.getAttribute('data-category') === 'loading_screen' && currentView === 'loading_screen') {
                    return; // Do nothing
                }
                
                const category = button.getAttribute('data-category');
                loadCosmeticsCategory(category);
                
                // Update the state of the lobby button
                if (category !== 'loading_screen') {
                    toggleLobbyBtn.textContent = translations[currentLanguage].toggleLobbyBtn;
                }
            });
        });
        
        // Listen for changes in the sort dropdown
        sortSelect.addEventListener('change', (event) => {
            currentSortOrder = event.target.value;
            updateGrid();
        });

        // Listen for changes in the rarity filter dropdown
        rarityFilterSelect.addEventListener('change', (event) => {
            currentFilterRarity = event.target.value;
            updateGrid();
        });
        
        // Listen for changes in the language select
        languageSelect.addEventListener('change', async (event) => {
            currentLanguage = event.target.value;
            // Clear cached data to force a re-fetch in the new language
            cosmeticData = {};
            updateUIForLanguage();
            await loadCosmeticsCategory(currentView);
        });

        // Toggle the "Filter New" state
        filterNewBtn.addEventListener('click', () => {
            isFilteringNew = !isFilteringNew;
            filterNewBtn.textContent = isFilteringNew ? translations[currentLanguage].filterNewBtnActive : translations[currentLanguage].filterNewBtn;
            updateGrid();
        });

        // Toggle between the current view and the loading screen view
        toggleLobbyBtn.addEventListener('click', async () => {
            if (currentView === 'loading_screen') {
                // Return to the previously active category (or outfits if none)
                await loadCosmeticsCategory('outfit');
            } else {
                await loadCosmeticsCategory('loading_screen');
                toggleLobbyBtn.textContent = translations[currentLanguage].toggleLobbyBtnActive;
            }
        });

        // --- Initial Application Load ---
        /**
         * Initializes the app on page load.
         */
        async function initializeApp() {
            // Set initial state from HTML selects
            currentLanguage = languageSelect.value;
            currentSortOrder = sortSelect.value;
            currentFilterRarity = rarityFilterSelect.value;

            appVersionDisplay.textContent = appVersion;

            // Load initial category and set UI state
            await loadCosmeticsCategory('outfit');
            updateUIForLanguage();
        }

        initializeApp();
    </script>
</body>
</html>
